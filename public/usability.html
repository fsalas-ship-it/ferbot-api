<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>FerBot ‚Äî Usabilidad</title>
  <style>
    :root{--bg:#0b0f19;--card:#111827;--ink:#E5E7EB;--mut:#93A3B8;--ok:#97C93E;--stroke:#1f2937}
    *{box-sizing:border-box}
    body{margin:0;background:#0b0f19;color:var(--ink);font:14px/1.5 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto}
    .wrap{max-width:1100px;margin:28px auto;padding:0 16px}
    .h{display:flex;justify-content:space-between;align-items:center}
    .pill{display:inline-flex;align-items:center;gap:8px;background:#121A2B;border:1px solid var(--stroke);color:#cbd5e1;border-radius:999px;padding:8px 12px;text-decoration:none;font-weight:700}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid var(--stroke);border-radius:16px;padding:18px 20px;margin:14px 0;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    th,td{text-align:left;padding:10px 12px;background:#0f1524;border-top:1px solid #1f2937;border-bottom:1px solid #1f2937}
    th:first-child,td:first-child{border-left:1px solid #1f2937;border-top-left-radius:10px;border-bottom-left-radius:10px}
    th:last-child,td:last-child{border-right:1px solid #1f2937;border-top-right-radius:10px;border-bottom-right-radius:10px}
    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    .k{background:#0f1524;border:1px solid #1f2937;border-radius:12px;padding:12px}
    .n{font-size:22px;font-weight:800}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="h">
      <h2>FerBot ¬∑ Usabilidad</h2>
      <div style="display:flex;gap:8px">
        <a class="pill" href="/panel">üß™ Panel</a>
        <a class="pill" href="/install">üìò Gu√≠a</a>
      </div>
    </div>

    <div class="kpis">
      <div class="k"><div>Respuestas mostradas</div><div id="k_shown" class="n">0</div></div>
      <div class="k"><div>Winrate compuesto</div><div id="k_wr" class="n">0%</div></div>
      <div class="k"><div>üëç Buenas</div><div id="k_good" class="n">0</div></div>
      <div class="k"><div>üëé Malas</div><div id="k_bad" class="n">0</div></div>
    </div>

    <div class="card">
      <table>
        <thead>
          <tr><th>Intent</th><th>Stage</th><th>Texto</th><th>Shown</th><th>Wins</th><th>Winrate</th></tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </div>
  </div>

  <script>
    const BASE="https://ferbot-api.onrender.com";
    const rows=document.getElementById("rows");
    const K=(id)=>document.getElementById(id);

    async function load(){
      try{
        const r=await fetch(`${BASE}/admin/usage_json`);
        if(!r.ok) return;
        const js=await r.json();
        const list=js?.ranking||[];
        rows.innerHTML="";
        let shown=0, wins=0, goods=0, bads=0;
        list.forEach(it=>{
          shown+=it.shown||0; wins+=it.wins||0;
          goods+=it.goods||0; bads+=it.bads||0;
          const tr=document.createElement("tr");
          tr.innerHTML=`<td>${it.intent||""}</td><td>${it.stage||""}</td><td>${(it.text||"").replace(/</g,"&lt;")}</td><td>${it.shown||0}</td><td>${it.wins||0}</td><td>${((it.winrate||0)*100).toFixed(1)}%</td>`;
          rows.appendChild(tr);
        });
        K("k_shown").textContent=shown;
        const wr=shown? ((wins/shown)*100).toFixed(1):"0.0";
        K("k_wr").textContent=`${wr}%`;
        K("k_good").textContent=goods;
        K("k_bad").textContent=bads;
      }catch(_){}
    }
    load(); setInterval(load,5000);
  </script>
</body>
</html>
